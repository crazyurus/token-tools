var render_method="canvas";var logo_url="";$(document).ready(function(){$(".fore-color").colorpicker();$(".bg-color").colorpicker();if(!Token.detect.isMobile()){$("#txt_card_birthday").datetimepicker({format:"yyyy-m-d",minView:"month",weekStart:1,autoclose:true,todayHighlight:true,language:"zh-CN"})}$("#btn_url").click(function(){var c=$("#txt_url").val().trim();if(Token.check.url(c)){Token.qrCode(c)}else{Token.message.alert("Url的格式不正确，请重新输入！")}});$("#btn_qq").click(function(){var c=$("#txt_qq").val().trim();if(Token.check.qq(c)){Token.qrCode("http://wpa.qq.com/msgrd?v=3&uin="+c+"&site=qq&menu=yes");$("#connect_qq").html('QQ状态：<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+c+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+c+':42" alt="QQ" title="通过QQ联系"></a>')}else{Token.message.alert("QQ号的格式不正确，请重新输入！")}});$("#btn_weibo").click(function(){var c=$("#txt_weibo").val().trim();if(Token.check.weibo(c)){Token.qrCode("http://weibo.cn/qr/userinfo?uid="+c)}else{Token.message.alert("微博uid的格式不正确，请重新输入！")}});$("#btn_wechat").click(function(){var c=$("#txt_wechat").val().trim();if(c!=""){Token.qrCode("http://weixin.qq.com/r/"+c)}else{Token.message.alert("微信ID的格式不正确，请重新输入！")}});$("#btn_app").click(function(){var c={id:$("#list_app").val(),ios_url:$("#txt_app_ios").val(),android_url:$("#txt_app_android").val(),wp_url:$("#txt_app_wp").val(),default_url:$("#txt_app_default").val()};if(c.id==0){Token.message.alert("请先选择App")}else{if(c.android_url==""||c.default_url==""){Token.message.alert("请输入App的下载地址信息！")}else{Token.ajax(Token.variable.app+"/tools/url/modify.do",c,function(d){Token.qrCode("http://token.team/app/"+d)})}}});$("#btn_card").click(function(){var i=$("#txt_card_name").val();var e="Token团队";var f=$("#txt_card_department").val();var j=$("#txt_card_position").val();var c="湖北省武汉市洪山区珞狮路122号";var h=$("#txt_card_tel").val();var l="027-87855617";var m="http://www.wutnews.net/";var g=$("#txt_card_email").val()+"@wutnews.net";var d=$("#txt_card_birthday").val();var k=$("#txt_card_qq").val();var o=$("#txt_card_wechat").val();var n="BEGIN:VCARD\r\nVERSION:2.1\r\nFN:"+i+"\r\nORG:"+e+f+"\r\nTITLE:"+j+"\r\nADR;WORK:;;"+c+"\r\nTEL;CELL;VOICE:"+h+"\r\nTEL;WORK;VOICE:"+l+"\r\nURL;WORK:"+m+"\r\nEMAIL;INTERNET,WORK:"+g+"\r\nBDAY:"+d+"\r\nX-QQ:"+k+"\r\nX-WECHAT:"+o+"\r\nEND:VCARD";if(i==""||f=="请选择……"||h==""){Token.message.alert("请将你的名片信息填写完整")}else{Token.qrCode(b(n))}});$(".weibo-group label").click(function(){$("#txt_weibo").val($(this).data("uid"))});$(".wechat-group label").click(function(){$("#txt_wechat").val($(this).data("id"))});$("#list_app").change(function(){var c=$(this).val();if(c==0){a("","","","")}else{Token.ajax(Token.variable.app+"/tools/url/getinfo.do?id="+c,{},function(d){a(d.android_url,d.ios_url,d.wp_url,d.default_url)})}});$(".render-group label").click(function(){render_method=$(this).text().trim().toLowerCase();switch(render_method){case"canvas":$(".logo-group label:not(':first')").removeAttr("disabled").removeClass("btn-disabled");break;case"table":$(".logo-group label:not(':first')").removeClass("active").attr("disabled","disabled").addClass("btn-disabled");$(".logo-group label:first").addClass("active");logo_url="";break;default:Token.message.alert("无效的二维码渲染参数！")}});$(".logo-group label").click(function(){if($(this).attr("disabled")){return false}if($(this).text()=="无"){logo_url=""}else{logo_url=$(this).find("img").attr("src").replace("preview","center")}});$("a.collapsed").click(function(){if($(this).attr("aria-expanded")=="true"){$("#col-icon").removeClass("glyphicon-chevron-up");$("#col-icon").addClass("glyphicon-chevron-down")}else{$("#col-icon").removeClass("glyphicon-chevron-down");$("#col-icon").addClass("glyphicon-chevron-up")}});$("#qrcode_size").change(function(){$("#qrcode_size_show").val($(this).val())});$("#qrcode_size_show").change(function(){var c=parseInt($(this).val());if(c<64||c>2048){Token.message.alert("二维码尺寸参数错误！");$(this).val($("#qrcode_size").val())}else{$("#qrcode_size").val($(this).val())}});$("#btn_download").click(function(){if($(this).attr("href")==""||render_method=="table"||Token.detect.isIE()){return false}});if(Token.detect.isIE()){$("#btn_download").html("不支持使用IE下载")}else{if(Token.detect.isMQQBrowser()){$("#btn_download").html("不支持QQ浏览器下载")}else{if(Token.detect.isUCBrowser()){$("#btn_download").html("不支持UC浏览器下载")}}}if(!Token.support.canvas()){$(".render-group label:last").click();$(".render-group label:first").attr("disabled","disabled")}function a(c,e,f,d){$("#txt_app_ios").val(e);$("#txt_app_android").val(c);$("#txt_app_wp").val(f);$("#txt_app_default").val(d)}function b(h){var g,e,f,d;g="";f=h.length;for(e=0;e<f;e++){d=h.charCodeAt(e);if((d>=1)&&(d<=127)){g+=h.charAt(e)}else{if(d>2047){g+=String.fromCharCode(224|((d>>12)&15));g+=String.fromCharCode(128|((d>>6)&63));g+=String.fromCharCode(128|((d>>0)&63))}else{g+=String.fromCharCode(192|((d>>6)&31));g+=String.fromCharCode(128|((d>>0)&63))}}}return g}});Token.qrCode=function(b){var a=parseInt($("#qrcode_size").val());if(a<64||a>2048){Token.message.alert("二维码尺寸参数错误！")}else{$("#qrcode").html("").qrcode({text:b,render:render_method,width:a,height:a,correctLevel:parseInt($("#qrcode_error").val()),background:$("#qrcode_bgcolor").val(),foreground:$("#qrcode_fcolor").val(),src:logo_url});if(render_method=="table"){$("#btn_download").attr("disabled","disabled").html("Table渲染方式不支持下载")}else{if(!Token.detect.isIE()){$("#btn_download").button("loading");setTimeout(function(){$("#btn_download").attr("href",$("canvas")[0].toDataURL("image/png")).removeAttr("disabled").button("reset")},1500)}}}};